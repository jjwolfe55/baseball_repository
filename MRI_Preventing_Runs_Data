INSERT INTO mri_preventing_pitching_raw (
player_id,
player_name,
team_id,
season_id,
age,
throw,
p_g,
p_gs,
p_ip,
p_bf,
p_s,
p_d,
p_t,
p_hr,
p_bb,
p_ibb,
p_hbp,
p_sb,
mri_pitching_raw)
SELECT 
a.player_id,
a.player_name,
a.team_id,
a.season_id,
a.age,
a.throw,
a.p_g,
a.p_gs,
a.p_ip,
a.p_bf,
((a.p_s*b.1b)*(c.run_adj)),
((a.p_d*b.2b)*(c.run_adj)),
((a.p_t*b.3b)*(c.run_adj)),
((a.p_hr*b.hr)*(c.run_adj)),
((a.p_bb*b.bb)*(c.run_adj)),
((a.p_ibb*b.ibb)*(c.run_adj)),
((a.p_hbp*b.hbp)*(c.run_adj)),
(((d.d_sb*b.sb)*(c.run_adj))*1/2),
(((a.p_s*b.1b)*(c.run_adj))+
((a.p_d*b.2b)*(c.run_adj))+
((a.p_t*b.3b)*(c.run_adj))+
((a.p_hr*b.hr)*(c.run_adj))+
((a.p_bb*b.bb)*(c.run_adj))+
((a.p_ibb*b.ibb)*(c.run_adj))+
((a.p_hbp*b.hbp)*(c.run_adj))+
(((d.d_sb*b.sb)*(c.run_adj))*1/2))
FROM standard_pitching AS a
INNER JOIN standard_linear_weights AS b
ON a.season_id = b.season_id
INNER JOIN standard_run_environment AS c
ON a.team_id = c.team_id AND a.season_id = c.season_id
INNER JOIN standard_fielding AS d
ON a.player_id = d.player_id AND a.team_id = d.team_id AND a.season_id = d.season_id
WHERE d.d_pos = 'p'
GROUP BY a.player_id,a.team_id,a.season_id;

INSERT INTO mri_preventing_baserunning_raw (
player_id,
player_name,
team_id,
season_id,
age,
throw,
d_pos,
d_sb,
d_cs,
mri_p_baserunning_raw)
SELECT 
a.player_id,
a.player_name,
a.team_id,
a.season_id,
a.age,
a.throw,
a.d_pos,
(((a.d_sb*b.sb)*(c.run_adj))*1/2),
((a.d_cs*b.cs)*(c.run_adj)),
((((a.d_sb*b.sb)*(c.run_adj))*1/2)+
((a.d_cs*b.cs)*(c.run_adj)))
FROM standard_fielding AS a
INNER JOIN standard_linear_weights AS b
ON a.season_id = b.season_id
INNER JOIN standard_run_environment AS c
ON a.team_id = c.team_id AND a.season_id = c.season_id
WHERE a.d_pos = 'c'
GROUP BY a.player_id,a.team_id,a.season_id;

INSERT INTO mri_calc_preventing_runs (
season_id,
total_mri_pitching_raw,
total_mri_p_baserunning_raw,
total_mri_preventing_raw,
total_earned_runs,
mri_preventing_runs_adj,
total_errors,
total_unearned_runs,
error_cost)
SELECT 
a.season_id,
a.total_mri_pitching_raw,
b.total_mri_p_baserunning_raw,
a.total_mri_pitching_raw + b.total_mri_p_baserunning_raw,
c.total_earned_runs,
((c.total_earned_runs)/(a.total_mri_pitching_raw + b.total_mri_p_baserunning_raw)),
d.total_errors,
e.total_unearned_runs,
((e.total_unearned_runs)/(d.total_errors))
FROM (SELECT season_id, SUM(mri_pitching_raw) AS total_mri_pitching_raw
FROM mri_preventing_pitching_raw GROUP BY season_id) AS a
INNER JOIN (SELECT season_id, SUM(mri_p_baserunning_raw) AS total_mri_p_baserunning_raw
FROM mri_preventing_baserunning_raw GROUP BY season_id) AS b
ON a.season_id = b.season_id
INNER JOIN (SELECT season_id, SUM(p_er) AS total_earned_runs
FROM standard_pitching GROUP BY season_id) AS c
ON a.season_id = c.season_id
INNER JOIN (SELECT season_id, SUM(d_e) AS total_errors
FROM standard_fielding GROUP BY season_id) AS d
ON a.season_id = d.season_id
INNER JOIN (SELECT season_id, (SUM(p_r) - SUM(p_er)) AS total_unearned_runs
FROM standard_pitching GROUP BY season_id) AS e
ON a.season_id = e.season_id
GROUP BY a.season_id
ORDER BY a.season_id DESC;

INSERT INTO mri_preventing_pitching_runs (
player_id,
player_name,
team_id,
season_id,
age,
throw,
mri_pitching_rc,
mri_pitching_avg)
SELECT 
a.player_id,
a.player_name,
a.team_id,
a.season_id,
a.age,
a.throw,
a.mri_pitching_raw*b.mri_preventing_runs_adj,
(a.mri_pitching_raw*b.mri_preventing_runs_adj)/c.p_bf
FROM mri_preventing_pitching_raw AS a
INNER JOIN mri_calc_preventing_runs AS b
ON a.season_id = b.season_id
INNER JOIN standard_pitching AS c
ON a.player_id = c.player_id AND a.team_id = c.team_id AND a.season_id = c.season_id
GROUP BY a.player_id,a.team_id,a.season_id;
