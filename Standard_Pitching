CREATE TABLE standard_pitching (
player_id VARCHAR(9),
player_name VARCHAR(45),
team_id VARCHAR(3),
season_id SMALLINT,
age SMALLINT,
throw CHAR(1),
p_g SMALLINT,
p_gs SMALLINT,
p_cg SMALLINT,
p_ip DECIMAL(6,1),
p_bf SMALLINT,
p_h SMALLINT,
p_s SMALLINT,
p_d SMALLINT,
p_t SMALLINT,
p_hr SMALLINT,
p_r SMALLINT,
p_er SMALLINT,
p_bb SMALLINT,
p_ibb SMALLINT,
p_so SMALLINT,
p_hbp SMALLINT,
p_sh SMALLINT,
p_sf SMALLINT,
p_sb SMALLINT,
p_cs SMALLINT,
p_bk SMALLINT,
p_wp SMALLINT,
p_pb SMALLINT,
p_wins SMALLINT,
p_losses SMALLINT,
p_saves SMALLINT,
PRIMARY KEY (player_id,team_id,season_id)
);

INSERT INTO standard_pitching (
player_id,
player_name,
team_id,
season_id,
throw,
p_g,
p_gs,
p_cg,
p_ip,
p_bf,
p_h,
p_s,
p_d,
p_t,
p_hr,
p_r,
p_er,
p_bb,
p_ibb,
p_so,
p_hbp,
p_sh,
p_sf,
p_sb,
p_cs,
p_bk,
p_wp,
p_pb,
p_wins,
p_losses,
p_saves
)
SELECT DISTINCT(a.player_id) AS player_id,
 CONCAT(b.first_name,' ',b.last_name) AS player_name,
 a.team_id AS team_id, 
 SUBSTRING(a.game_date,1,4) AS season_id,
 b.throw AS throw,
 c.p_g AS p_g, 
 c.p_gs AS p_gs,
 c.p_cg AS p_cg,
 c.p_ip AS p_ip,
 c.p_bf AS p_bf,
 c.p_h AS p_h,
 c.p_s AS p_s,
 c.p_d AS p_d,
 c.p_t AS p_t,
 c.p_hr AS p_hr,
 c.p_r AS p_r,
 c.p_er AS p_er,
 c.p_bb AS p_bb,
 c.p_ibb AS p_ibb,
 c.p_so AS p_so,
 c.p_hbp AS p_hbp,
 c.p_sh AS p_sh,
 c.p_sf AS p_sf, 
 c.p_sb AS p_sb,
 c.p_cs AS p_cs,
 c.p_bk AS p_bk,
 c.p_wp AS p_wp,
 c.p_pb AS p_pb,
 c.p_wins AS p_wins,
 c.p_losses AS p_losses,
 c.p_saves AS p_saves
FROM lines_pitching AS a
LEFT JOIN lines_rosters AS b
ON a.player_id = b.player_id AND a.team_id = b.team_id
INNER JOIN 
(SELECT DISTINCT(a.player_id) AS player_id,
a.team_id AS team_id,
a.game_id AS game_id,
SUBSTRING(a.game_date,1,4) AS season_id,
COUNT(a.player_id) AS p_g,
SUM(a.p_gs) AS p_gs,
SUM(a.p_cg) AS p_cg,
(SUM(a.p_ipouts)/3) AS p_ip,
SUM(a.p_bf) AS p_bf,
SUM(a.p_h) AS p_h,
SUM(a.p_h)-(SUM(a.p_d)+SUM(a.p_t)+SUM(a.p_hr)) AS p_s,
SUM(a.p_d) AS p_d,
SUM(a.p_t) AS p_t,
SUM(a.p_hr) AS p_hr,
SUM(a.p_r) AS p_r,
SUM(a.p_er) AS p_er,
SUM(a.p_bb) AS p_bb,
SUM(a.p_ibb) AS p_ibb,
SUM(a.p_so) AS p_so,
SUM(a.p_hbp) AS p_hbp,
SUM(a.p_sh) AS p_sh,
SUM(a.p_sf) AS p_sf,
SUM(a.p_sb) AS p_sb,
SUM(a.p_cs) AS p_cs,
SUM(a.p_bk) AS p_bk,
SUM(a.p_wp) AS p_wp,
SUM(a.p_pb) AS p_pb,
SUM(a.p_wins) AS p_wins,
SUM(a.p_losses) AS p_losses,
SUM(a.p_saves) AS p_saves
FROM lines_pitching AS a
WHERE a.integrity = 'Value' AND a.game_type = 'regular' 
GROUP BY a.player_id,a.team_id,SUBSTRING(a.game_date,1,4)) AS c
ON a.player_id = c.player_id  AND a.team_id = c.team_id AND a.game_id = c.game_id
WHERE a.integrity = 'Value' AND a.game_type = 'regular' 
GROUP BY a.player_id,a.team_id,SUBSTRING(a.game_date,1,4);
